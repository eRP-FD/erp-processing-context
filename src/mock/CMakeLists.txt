#
# (C) Copyright IBM Deutschland GmbH 2021
# (C) Copyright IBM Corp. 2021
#

set(TEST_DATA_DIR "${CMAKE_SOURCE_DIR}/resources/test")
set(GENERATED_NOTE "This file has been generated by CMake")
configure_file("${CMAKE_CURRENT_SOURCE_DIR}/mock_config.h.in" "${CMAKE_CURRENT_BINARY_DIR}/mock_config.h")

add_library(erp-hsm-tpm-mock OBJECT)
target_sources(erp-hsm-tpm-mock
    PRIVATE
        crypto/MockCryptography.cxx
        hsm/HsmMockClient.cxx
        hsm/HsmMockFactory.cxx
        hsm/MockBlobCache.cxx
        tpm/TpmMock.cxx
        tpm/TpmTestHelper.cxx
        util/MockConfiguration.cxx
    INTERFACE $<TARGET_OBJECTS:erp-hsm-tpm-mock>
)


target_link_libraries(erp-hsm-tpm-mock
    PUBLIC
        CONAN_PKG::boost
        CONAN_PKG::date
        CONAN_PKG::glog
        CONAN_PKG::gsl-lite
        CONAN_PKG::libpq
        CONAN_PKG::libpqxx
        CONAN_PKG::magic_enum
        CONAN_PKG::openssl
        CONAN_PKG::rapidjson
)


target_compile_definitions(erp-hsm-tpm-mock
        PRIVATE
            ENABLE_DEBUG_LOG
        PUBLIC
            WITH_HSM_MOCK=1
    )

target_include_directories(
    erp-hsm-tpm-mock
        PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/.. # Include the erp prefixes in include statements.
                ${CMAKE_CURRENT_BINARY_DIR}

)


if (ERP_WITH_HSM_MOCK)
    target_link_libraries(erp-processing-context-files
            PUBLIC
            erp-hsm-tpm-mock)
endif()

if(ERP_WITH_HSM_TPM_PRODUCTION)
add_library(erp-mock-enrollmentmanager OBJECT)
target_sources(erp-mock-enrollmentmanager
        PRIVATE
        enrolment/MockEnrolmentManager.cxx
        )
target_link_libraries (
        erp-mock-enrollmentmanager
        PUBLIC
        CONAN_PKG::boost
        CONAN_PKG::date
        CONAN_PKG::glog
        CONAN_PKG::gsl-lite
        CONAN_PKG::libpq
        CONAN_PKG::libpqxx
        CONAN_PKG::magic_enum
        CONAN_PKG::openssl
        CONAN_PKG::rapidjson
        CONAN_PKG::hsmclient
        CONAN_PKG::tpmclient
)
target_include_directories(
        erp-mock-enrollmentmanager
        PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/.. # Include the erp prefixes in include statements.
        ${CMAKE_CURRENT_BINARY_DIR}
)

if(ERP_WITH_HSM_MOCK)
target_link_libraries(erp-processing-context-files
        PUBLIC
        erp-mock-enrollmentmanager)
endif()
endif()